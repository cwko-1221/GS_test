<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ”¿åºœç†è²¡å¤§ä½œæˆ° (å–®æ©Ÿç‰ˆ)</title>
    <!-- å¼•å…¥ QR Code ç”Ÿæˆå™¨ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Microsoft JhengHei', 'Heiti TC', sans-serif; touch-action: none; background: #f0f0f0; user-select: none; -webkit-user-select: none; }
        
        /* é€šç”¨ç•«é¢è¨­å®š */
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.3s; }
        .hidden { display: none !important; opacity: 0; }
        
        h1 { color: #2c3e50; margin-bottom: 5px; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #34495e; font-size: 1.2rem; margin-bottom: 20px; }
        p { color: #555; margin-bottom: 20px; text-align: center; max-width: 90%; line-height: 1.5; }
        
        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
        input { padding: 15px; font-size: 20px; border: 3px solid #ddd; border-radius: 12px; margin-bottom: 20px; width: 80%; max-width: 300px; text-align: center; outline: none; transition: 0.3s; }
        input:focus { border-color: #2196F3; box-shadow: 0 0 10px rgba(33, 150, 243, 0.3); }
        
        .btn { padding: 15px 40px; margin: 10px; font-size: 20px; border: none; border-radius: 50px; cursor: pointer; color: white; width: 85%; max-width: 350px; box-shadow: 0 6px 0 rgba(0,0,0,0.1); transition: all 0.1s; font-weight: bold; }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-student { background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%); }
        .btn-teacher { background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); color: #444; }
        .btn-back { background: #95a5a6; margin-top: 20px; font-size: 16px; padding: 10px 30px; }

        /* éŠæˆ²ç•«å¸ƒ */
        canvas { background: #eee; display: block; }

        /* é¡Œç›®å½ˆçª— */
        #questionModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 450px; background: white; border: 6px solid #FF9800; border-radius: 20px; padding: 20px; box-sizing: border-box; text-align: center; z-index: 100; box-shadow: 0 0 100px rgba(0,0,0,0.7); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        
        #qTitle { font-size: 22px; margin-bottom: 15px; color: #333; font-weight: bold; }
        .opt-btn { display: block; width: 100%; padding: 15px; margin: 8px 0; background: #fff; color: #333; border: 2px solid #ddd; border-radius: 10px; font-size: 18px; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .opt-btn:hover { background: #e8f5e9; border-color: #4CAF50; color: #2e7d32; }
        .opt-btn:active { background: #4CAF50; color: white; }

        /* è€å¸«ç•«é¢ */
        #qrcode { margin: 20px; padding: 10px; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        /* HUD */
        #hud { position: absolute; top: 10px; left: 10px; pointer-events: none; z-index: 5; display: flex; flex-direction: column; gap: 5px; }
        .hud-box { background: rgba(0,0,0,0.6); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 16px; backdrop-filter: blur(5px); }
        
        #timeBarContainer { position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: rgba(0,0,0,0.1); z-index: 6; }
        #timeBar { width: 0%; height: 100%; background: #FF9800; transition: width 0.1s linear; }
        
        /* æ–æ¡¿æŒ‡ç¤º (Mobile) */
        #joystick-hint { position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%); color: rgba(0,0,0,0.3); font-size: 14px; pointer-events: none; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.7; } }
    </style>
</head>
<body>

    <!-- 1. ä¸»é¸å–® -->
    <div id="menuScreen" class="screen">
        <div style="font-size: 60px; margin-bottom: 10px;">ğŸ¦</div>
        <h1>æ”¿åºœç†è²¡å¤§ä½œæˆ°</h1>
        <h2>å¸¸è­˜ç§‘äº’å‹•éŠæˆ²</h2>
        
        <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥ä½ çš„åå­—" maxlength="8">
        
        <button class="btn btn-student" onclick="startGame()">æˆ‘æ˜¯å­¸ç”Ÿ (é–‹å§‹éŠæˆ²)</button>
        <button class="btn btn-teacher" onclick="showTeacherScreen()">æˆ‘æ˜¯è€å¸« (é¡¯ç¤º QR Code)</button>
        
        <p style="font-size: 12px; margin-top: 30px; color: #888;">v1.0 å–®æ©Ÿç·´ç¿’ç‰ˆ (AI å°æˆ°)</p>
    </div>

    <!-- 2. è€å¸«ç•«é¢ -->
    <div id="teacherScreen" class="screen hidden">
        <h1>ğŸ“± æƒæåŠ å…¥éŠæˆ²</h1>
        <p>è«‹å­¸ç”Ÿä½¿ç”¨å¹³æ¿æˆ–æ‰‹æ©Ÿæƒææ­¤ QR Code</p>
        <div id="qrcode"></div>
        <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 10px; font-family: monospace;">
            <span id="urlText"></span>
        </div>
        <button class="btn btn-back" onclick="location.reload()">è¿”å›ä¸»é¸å–®</button>
    </div>

    <!-- 3. éŠæˆ²ç•«é¢ -->
    <div id="gameUI" class="hidden">
        <div id="timeBarContainer"><div id="timeBar"></div></div>
        
        <canvas id="canvas"></canvas>
        
        <div id="hud">
            <div class="hud-box">ğŸ‘¤ <span id="hudName">Player</span></div>
            <div class="hud-box">ğŸ“Š åˆ†æ•¸: <span id="hudScore">0</span></div>
            <div class="hud-box">ğŸ† æ’å: <span id="hudRank">-</span></div>
        </div>

        <div id="joystick-hint">æ‹–æ›³ç•«é¢ç§»å‹•</div>
        
        <!-- é¡Œç›®è¦–çª— -->
        <div id="questionModal">
            <div style="font-size: 40px; margin-bottom: 10px;">â“</div>
            <h2 id="qTitle">é¡Œç›®è¼‰å…¥ä¸­...</h2>
            <div id="qOptions"></div>
        </div>
    </div>

    <script>
        // ================= éŠæˆ²å¸¸æ•¸è¨­å®š =================
        const WORLD_SIZE = 2500;  // åœ°åœ–å¤§å°
        const BOT_COUNT = 20;     // AI æ•¸é‡
        const INITIAL_RADIUS = 30; // ç©å®¶åˆå§‹å¤§å°
        const QUESTION_INTERVAL = 15000; // æ¯ 15 ç§’ä¸€é¡Œ
        
        // é¡Œç›®åº« (æ ¹æ“šå¸¸è­˜ç§‘æ”¿åºœç†è²¡å…§å®¹)
        const questions = [
            { q: "æ”¿åºœç†è²¡çš„é¦–è¦åŸå‰‡æ˜¯ä»€éº¼ï¼Ÿ", opts: ["é‡å…¥ç‚ºå‡º", "å…ˆä½¿æœªä¾†éŒ¢", "éš¨æ„æ¶ˆè²»"], ans: 0 },
            { q: "æ‰“å·¥ä»”æ¯æœˆæœ‰è–ªé‡‘ï¼Œéœ€è¦ç¹³äº¤ä»€éº¼ç¨…ï¼Ÿ", opts: ["åˆ©å¾—ç¨…", "è–ªä¿¸ç¨…", "å°èŠ±ç¨…"], ans: 1 },
            { q: "å…¬å¸æˆ–ä¼æ¥­è³ºå–åˆ©æ½¤å¾Œï¼Œéœ€è¦ç¹³äº¤ä»€éº¼ç¨…ï¼Ÿ", opts: ["è–ªä¿¸ç¨…", "å°èŠ±ç¨…", "åˆ©å¾—ç¨…"], ans: 2 },
            { q: "è²·è³£æ¨“å®‡ä½å®…æ™‚ï¼Œéœ€è¦ç¹³äº¤ä»€éº¼ç¨…ï¼Ÿ", opts: ["å°èŠ±ç¨…", "åœ°åƒ¹ç¨…", "å¢å€¼ç¨…"], ans: 0 },
            { q: "ç•¶æ”¿åºœæ”¶å…¥æ¯”é–‹æ”¯å¤šï¼Œæœƒå‡ºç¾ä»€éº¼æƒ…æ³ï¼Ÿ", opts: ["èµ¤å­—", "ç›ˆé¤˜", "ç ´ç”¢"], ans: 1 },
            { q: "æ”¿åºœæœƒæŠŠã€Œç›ˆé¤˜ã€æ’¥å…¥å“ªè£¡ä»¥å‚™ä¸æ™‚ä¹‹éœ€ï¼Ÿ", opts: ["è²¡æ”¿å„²å‚™", "å®˜å“¡å£è¢‹", "æ´¾ç™¼çé‡‘"], ans: 0 },
            { q: "ä»¥ä¸‹å“ªé …ä¸æ˜¯é¦™æ¸¯æ”¿åºœçš„ä¸»è¦é–‹æ”¯ï¼Ÿ", opts: ["æ•™è‚²", "åœ‹é˜²è»è²»", "é†«ç™‚è¡ç”Ÿ"], ans: 1 },
            { q: "èˆˆå»ºæ¸¯ç æ¾³å¤§æ©‹å±¬æ–¼å“ªä¸€é¡æ”¿åºœé–‹æ”¯ï¼Ÿ", opts: ["ç¤¾æœƒç¦åˆ©", "åŸºç¤å»ºè¨­", "ä¿å®‰"], ans: 1 },
            { q: "äº«ç”¨å…¬å…±è¨­æ–½æ˜¯æ¬Šåˆ©ï¼Œç¹³ç¨…æ˜¯å¸‚æ°‘çš„ä»€éº¼ï¼Ÿ", opts: ["èˆˆè¶£", "é¸æ“‡", "ç¾©å‹™"], ans: 2 },
            { q: "å¦‚æœæ”¿åºœé•·æœŸã€Œå…¥ä¸æ•·å‡ºã€ï¼Œæœƒå°è‡´ä»€éº¼ï¼Ÿ", opts: ["è²¡æ”¿èµ¤å­—", "ç¶“æ¿Ÿç¹æ¦®", "ç¨…æ”¶æ¸›å°‘"], ans: 0 },
            { q: "è²¡æ”¿é ç®—æ¡ˆé€šå¸¸ç”±èª°å®£è®€ï¼Ÿ", opts: ["è¡Œæ”¿é•·å®˜", "è²¡æ”¿å¸å¸é•·", "å¾‹æ”¿å¸å¸é•·"], ans: 1 }
        ];

        // è®Šæ•¸
        let canvas, ctx;
        let player = { x: 0, y: 0, r: INITIAL_RADIUS, color: '#2196F3', name: '' };
        let bots = [];
        let particles = []; // è¢«åƒæ‰æ™‚çš„ç‰¹æ•ˆç²’å­
        let cameraX = 0, cameraY = 0;
        let gameRunning = false;
        let mouseX = 0, mouseY = 0;
        let questionTimer;
        let nextQuestionTime = 0;

        // åˆå§‹åŒ–
        window.onload = () => {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            resize();
            window.addEventListener('resize', resize);
            
            // ç¶å®šè¼¸å…¥
            window.addEventListener('mousemove', e => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            window.addEventListener('touchmove', e => {
                e.preventDefault();
                mouseX = e.touches[0].clientX;
                mouseY = e.touches[0].clientY;
            }, {passive: false});
        };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if(!gameRunning) {
                mouseX = canvas.width / 2;
                mouseY = canvas.height / 2;
            }
        }

        // ================= è€å¸«åŠŸèƒ½ =================
        function showTeacherScreen() {
            document.getElementById('menuScreen').classList.add('hidden');
            document.getElementById('teacherScreen').classList.remove('hidden');
            
            const url = window.location.href;
            document.getElementById('urlText').innerText = "ç•¶å‰ç¶²å€"; // é è¦½æ¨¡å¼ä¸‹ç¶²å€å¯èƒ½å¾ˆé•·
            
            // æ¸…ç©ºèˆŠçš„
            document.getElementById("qrcode").innerHTML = "";
            new QRCode(document.getElementById("qrcode"), { 
                text: url, 
                width: 200, 
                height: 200,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        // ================= éŠæˆ²æ ¸å¿ƒé‚è¼¯ =================
        function startGame() {
            const nameInput = document.getElementById('playerName').value.trim();
            if(!nameInput) {
                // éœ‡å‹•ç‰¹æ•ˆ
                const input = document.getElementById('playerName');
                input.style.border = "3px solid red";
                setTimeout(() => input.style.border = "3px solid #ddd", 500);
                return;
            }
            
            player.name = nameInput;
            document.getElementById('hudName').innerText = nameInput;
            document.getElementById('menuScreen').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            
            // åˆå§‹åŒ–æ»‘é¼ ä½ç½®åœ¨ä¸­å¿ƒï¼Œé¿å…ä¸€é–‹å§‹å°±æš´è¡
            mouseX = canvas.width / 2;
            mouseY = canvas.height / 2;

            initGameWorld();
            gameRunning = true;
            loop();
            
            // è¨­å®šç¬¬ä¸€é¡Œæ™‚é–“
            nextQuestionTime = Date.now() + QUESTION_INTERVAL;
            questionTimer = setInterval(checkQuestionTime, 100);
        }

        function initGameWorld() {
            // é‡ç½®ç©å®¶
            player.x = Math.random() * WORLD_SIZE;
            player.y = Math.random() * WORLD_SIZE;
            player.r = INITIAL_RADIUS;
            player.color = `hsl(${Math.random() * 360}, 70%, 50%)`;
            
            // é‡ç½® AI
            bots = [];
            for(let i=0; i<BOT_COUNT; i++) {
                spawnBot();
            }
        }

        function spawnBot() {
            const names = ["ç´ç¨…äºº", "å¤§è²¡ä¸»", "åº«å‹™å±€", "ç²¾æ˜çœ¼", "æ”¶ç§Ÿä½¬", "å¤§å¥½å‹", "å°è‚¡æ°‘", "æ¶ˆè²»è€…", "æ‰“å·¥ä»”", "è€é—†", "éŠå®¢", "ç‚’å®¶"];
            bots.push({
                x: Math.random() * WORLD_SIZE,
                y: Math.random() * WORLD_SIZE,
                r: Math.random() * 20 + 15, // 15-35
                color: `hsl(${Math.random() * 360}, 60%, 60%)`,
                vx: (Math.random() - 0.5) * 3,
                vy: (Math.random() - 0.5) * 3,
                name: names[Math.floor(Math.random() * names.length)],
                changeDirTime: 0
            });
        }

        function checkQuestionTime() {
            if(!gameRunning) return;
            const now = Date.now();
            const timeLeft = nextQuestionTime - now;
            
            // æ›´æ–°é€²åº¦æ¢
            const percentage = Math.max(0, (timeLeft / QUESTION_INTERVAL) * 100);
            document.getElementById('timeBar').style.width = percentage + "%";

            if(timeLeft <= 0) {
                // æ™‚é–“åˆ°ï¼Œå‡ºé¡Œ
                nextQuestionTime = now + QUESTION_INTERVAL + 99999999; // æš«åœè¨ˆæ™‚ç›´åˆ°å›ç­”å®Œ
                askQuestion();
            }
        }

        function askQuestion() {
            const q = questions[Math.floor(Math.random() * questions.length)];
            const modal = document.getElementById('questionModal');
            const content = document.getElementById('qOptions');
            
            document.getElementById('qTitle').innerText = q.q;
            content.innerHTML = "";
            modal.style.display = 'block';

            q.opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => {
                    modal.style.display = 'none';
                    if(i === q.ans) {
                        player.r += 15; // çå‹µ
                        createParticles(player.x, player.y, 10, "#FFD700"); // é‡‘è‰²ç‰¹æ•ˆ
                        // alert("âœ… ç­”å°äº†ï¼è³‡ç”¢å¤§å¢ï¼");
                    } else {
                        // alert("âŒ ç­”éŒ¯äº†ï¼è³‡ç”¢ä¸è®Šã€‚");
                        player.r = Math.max(10, player.r - 5); // æ‡²ç½°ä¸€é»é»
                    }
                    // é‡ç½®è¨ˆæ™‚å™¨
                    nextQuestionTime = Date.now() + QUESTION_INTERVAL;
                };
                content.appendChild(btn);
            });
        }

        function loop() {
            if(!gameRunning) return;
            update();
            draw();
            requestAnimationFrame(loop);
        }

        function update() {
            // 1. ç©å®¶ç§»å‹•
            const dx = mouseX - canvas.width / 2;
            const dy = mouseY - canvas.height / 2;
            const distMouse = Math.hypot(dx, dy);
            const angle = Math.atan2(dy, dx);
            
            // æ ¹æ“šå¤§å°èª¿æ•´é€Ÿåº¦ï¼Œè¶Šå¤§è¶Šæ…¢
            const speed = Math.max(2, 6 - (player.r / 50)); 
            
            if(distMouse > 10) {
                player.x += Math.cos(angle) * speed;
                player.y += Math.sin(angle) * speed;
            }

            // é‚Šç•Œ
            player.x = Math.max(0, Math.min(WORLD_SIZE, player.x));
            player.y = Math.max(0, Math.min(WORLD_SIZE, player.y));

            // 2. AI é‚è¼¯
            const now = Date.now();
            bots.forEach(bot => {
                // AI ç§»å‹•
                bot.x += bot.vx;
                bot.y += bot.vy;

                // é‚Šç•Œåå½ˆ
                if(bot.x < 0 || bot.x > WORLD_SIZE) bot.vx *= -1;
                if(bot.y < 0 || bot.y > WORLD_SIZE) bot.vy *= -1;

                // éš¨æ©Ÿæ”¹è®Šæ–¹å‘
                if(now > bot.changeDirTime) {
                    // å¦‚æœé™„è¿‘æœ‰ç©å®¶ä¸”ç©å®¶æ¯”AIå¤§ï¼Œé€ƒè·‘
                    const dToPlayer = Math.hypot(player.x - bot.x, player.y - bot.y);
                    if(dToPlayer < 300 && player.r > bot.r * 1.1) {
                         const escAngle = Math.atan2(bot.y - player.y, bot.x - player.x);
                         bot.vx = Math.cos(escAngle) * 3;
                         bot.vy = Math.sin(escAngle) * 3;
                    } else {
                        bot.vx = (Math.random() - 0.5) * 4;
                        bot.vy = (Math.random() - 0.5) * 4;
                    }
                    bot.changeDirTime = now + 1000 + Math.random() * 2000;
                }
            });

            // 3. ç¢°æ’æª¢æ¸¬
            checkCollisions();
            
            // 4. ç²’å­ç‰¹æ•ˆæ›´æ–°
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                if(p.life <= 0) particles.splice(i, 1);
            }

            // 5. æ›´æ–° UI
            const all = [...bots, player].sort((a, b) => b.r - a.r);
            const rank = all.indexOf(player) + 1;
            document.getElementById('hudScore').innerText = Math.floor(player.r);
            document.getElementById('hudRank').innerText = `${rank} / ${all.length}`;
        }

        function checkCollisions() {
            // ç©å®¶ vs AI
            for (let i = bots.length - 1; i >= 0; i--) {
                const bot = bots[i];
                const dist = Math.hypot(player.x - bot.x, player.y - bot.y);
                
                // åƒæ‰é‚è¼¯ï¼šè·é›¢ < åŠå¾‘ && é«”ç©å¤§æ–¼å°æ–¹ 10%
                if (dist < player.r && player.r > bot.r * 1.1) {
                    player.r += bot.r * 0.4; // å¸æ”¶
                    createParticles(bot.x, bot.y, 5, bot.color);
                    bots.splice(i, 1);
                    setTimeout(spawnBot, 2000); // 2ç§’å¾Œé‡ç”Ÿä¸€å€‹
                } 
                // è¢«åƒé‚è¼¯
                else if (dist < bot.r && bot.r > player.r * 1.1) {
                    gameOver(`ä½ è¢«ã€Œ${bot.name}ã€åä½µäº†ï¼`);
                    return;
                }
            }
            
            // AI vs AI (ç°¡åŒ–ç‰ˆï¼šä¸äº’åƒï¼Œåªäº’æ¨ï¼Œé¿å…AIå¤ªå¿«æ­»å…‰)
             for(let i=0; i<bots.length; i++) {
                 for(let j=i+1; j<bots.length; j++) {
                     let b1 = bots[i];
                     let b2 = bots[j];
                     let d = Math.hypot(b1.x - b2.x, b1.y - b2.y);
                     if(d < b1.r + b2.r) {
                         // ç°¡å–®æ¨é–‹
                         let angle = Math.atan2(b1.y - b2.y, b1.x - b2.x);
                         b1.vx += Math.cos(angle) * 0.1;
                         b1.vy += Math.sin(angle) * 0.1;
                     }
                 }
             }
        }

        function createParticles(x, y, count, color) {
            for(let i=0; i<count; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color
                });
            }
        }

        function gameOver(reason) {
            gameRunning = false;
            clearInterval(questionTimer);
            alert(reason + `\næœ€çµ‚åˆ†æ•¸ï¼š${Math.floor(player.r)}`);
            location.reload();
        }

        // ================= ç¹ªåœ– =================
        function draw() {
            // èƒŒæ™¯
            ctx.fillStyle = "#f5f7fa";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ”å½±æ©Ÿè·Ÿéš¨
            cameraX = player.x - canvas.width / 2;
            cameraY = player.y - canvas.height / 2;

            ctx.save();
            ctx.translate(-cameraX, -cameraY);

            drawGrid();

            // ç•«ç²’å­
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            });

            // ç•« AI
            bots.forEach(bot => drawCell(bot));

            // ç•«ç©å®¶
            drawCell(player, true);

            ctx.restore();
        }

        function drawCell(obj, isPlayer = false) {
            ctx.beginPath();
            ctx.arc(obj.x, obj.y, obj.r, 0, Math.PI * 2);
            ctx.fillStyle = obj.color;
            ctx.shadowBlur = isPlayer ? 20 : 0;
            ctx.shadowColor = obj.color;
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // é‚Šæ¡†
            ctx.lineWidth = isPlayer ? 4 : 2;
            ctx.strokeStyle = "rgba(0,0,0,0.1)";
            ctx.stroke();
            
            // äº®æ–‘ (ç«‹é«”æ„Ÿ)
            ctx.beginPath();
            ctx.arc(obj.x - obj.r*0.3, obj.y - obj.r*0.3, obj.r*0.2, 0, Math.PI*2);
            ctx.fillStyle = "rgba(255,255,255,0.3)";
            ctx.fill();

            // åå­—
            ctx.fillStyle = "#333";
            ctx.font = isPlayer ? "bold 16px sans-serif" : "12px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(obj.name, obj.x, obj.y);
        }

        function drawGrid() {
            ctx.strokeStyle = "#e0e0e0";
            ctx.lineWidth = 1;
            ctx.beginPath();
            for (let x = 0; x <= WORLD_SIZE; x += 50) {
                ctx.moveTo(x, 0); ctx.lineTo(x, WORLD_SIZE);
            }
            for (let y = 0; y <= WORLD_SIZE; y += 50) {
                ctx.moveTo(0, y); ctx.lineTo(WORLD_SIZE, y);
            }
            ctx.stroke();
            
            // ç´…è‰²é‚Šç•Œ
            ctx.strokeStyle = "#ffcdd2";
            ctx.lineWidth = 10;
            ctx.strokeRect(0, 0, WORLD_SIZE, WORLD_SIZE);
        }
    </script>
</body>
</html>